{{ define "body_class" }}post-page tutorial-page{{ end }}


{{ define "head" }}
	<meta name="description" content="{{ .Params.description }}">
	<meta name="keywords" content="{{ delimit .Params.tags ", " | lower }}">
	<meta name="revised" content="{{ .Page.Lastmod }}" >

	{{ with $.Site.GetPage "taxonomy" (printf "author/%s" .Params.author) }}
		<meta name="author" content="{{ .Params.name }}">
	{{ end }}

	<meta property="og:title" content="{{ .Title }}">
	<meta property="og:description" content="{{ .Params.description }}">

	<meta property="og:site_name" content="{{ .Site.Title }}">
	<meta property="og:url" content="{{ .Permalink }}">
	{{ with .Resources.GetMatch "header" }}
		{{ $image := .Fill "400x400 smart" }}
		<meta property="og:image" content="{{ $image.Permalink }}">
		<meta property="og:image:width" content="{{ $image.Width }}">
		<meta property="og:image:height" content="{{ $image.Height }}">
	{{ end }}

	<meta property="og:type" content="article">
	<meta property="article:published_time" content="{{ .Date }}">
	<meta property="article:modified_time" content="{{ .Lastmod }}">
	{{ with $.Site.GetPage "taxonomy" (printf "author/%s" .Params.author) }}
	<meta property="article:author" content="{{ .Params.name }}">
	{{ end }}

	{{ range .Params.tags }}
		<meta property="article:tag" content="{{ . | lower }}">
	{{- end }}
{{ end }}


{{ define "main" }}

	{{ if .Params.colour }}
		{{ $css := resources.Get "css/pageStyles/post.scss" | resources.ExecuteAsTemplate (printf "page-%s.scss" .UniqueID) .Params.colour | resources.ToCSS (dict "outputStyle" "compressed") }}
		<style type="text/css">{{ $css.Content | safeCSS }}</style>
	{{ end }}

	<article class="post post--full">

		<header class="post-header" style="background-image:url('{{ ((.Resources.GetMatch "header" | default (resources.Get "images/header.jpg")).Fill "1920x500 smart").RelPermalink }}')">
			<div class="post-header__inner">
				<h1>{{ .Title }}</h1>
				<p class="post-header__meta">
					<time>{{ .Date.Format ("January 02, 2006") }}</time>

					{{ with $.Site.GetPage "taxonomy" (printf "subject/%s" .Params.subject) }}
						<a href="{{ .RelPermalink }}">{{ .Title }}{{ with $.Params.subject_version }} {{ . }}{{ end }}</a>
					{{ end }}

					<span>{{ .Params.level }}</span>
				</p>
			</div>

			<!-- <aside class="post-meta">
				TODO add meta information
			</aside> -->
		</header>

		<section class="post__content post__content--intro">
			<p>{{ .Params.description }}</p>
		</section>

		<hr>

		<section class="post__content">
			{{ $content := .Content | replaceRE "(<h2 id=\"([^\"]+)\">)(.+)(</h2+>)" "${1}<a href=\"#${2}\">#</a> <span>${3}</span> ${4}" }}
			{{ $content = $content | replaceRE "<a href=\"(https?://[^\"]+)\">(.+)</a>" "<a href=\"${1}\" target=\"_blank\" class=\"external\">${2}</a>" }}
			{{ $content | safeHTML }}
		</section>

		<footer role="contentinfo" class="post__tags">
			{{ with .Params.tags -}}
			<section>
				<strong>Tags</strong>
				{{ range . }}
					{{- $name := . -}}
					{{- with $.Site.GetPage "taxonomy" (printf "tags/%s" $name) -}}
						<a href="{{ .RelPermalink }}">{{ $name | lower }}</a>
					{{ end -}}
				{{ end }}
			</section>
			{{- end }}
		</footer>

		{{- with $.Site.GetPage "taxonomy" (printf "author/%s" .Params.author) -}}
			{{ .Render "summary" }}
		{{ end -}}

	</article>

	<script src="{{ (resources.Get "js/post.js" | resources.Minify).RelPermalink }}"></script>
{{ end }}
